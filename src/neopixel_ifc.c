#include "neopixel_ifc.h"

#include <errno.h>
#include <string.h>

#define LOG_LEVEL 4
#include <zephyr/logging/log.h>
LOG_MODULE_REGISTER(main);

#include <zephyr/kernel.h>
#include <zephyr/drivers/led_strip.h>
#include <zephyr/device.h>
#include <zephyr/drivers/spi.h>
#include <zephyr/sys/util.h>

#define STRIP_NODE		DT_ALIAS(led_strip)
#define STRIP_NUM_PIXELS	DT_PROP(DT_ALIAS(led_strip), chain_length)

#define DELAY_TIME K_MSEC(10)
#define DELAY_TIME_LOGO K_MSEC(30)

#define RGB(_r, _g, _b) { .r = (_r), .g = (_g), .b = (_b) }

static const struct led_rgb colors[] = {
	RGB(0x0f, 0x00, 0x00), /* red */
	RGB(0x00, 0x0f, 0x00), /* green */
	RGB(0x00, 0x00, 0x0f), /* blue */
	RGB(0x0f, 0x0f, 0x00), /* yellow */
};

struct led_rgb pixels[STRIP_NUM_PIXELS];

static const struct device *const strip = DEVICE_DT_GET(STRIP_NODE);

static uint32_t display_offset = 0;

#define COLUMNS 16
#define ROWS    16

// Basic alphabet
uint8_t letters[][6] = {
{ 0x00, 0x00, 0x00, 0x00, 0x00, 0x00}, // SPACE
{ 0x7F, 0x88, 0x88, 0x88, 0x7F, 0x00}, // A
{ 0xFF, 0x91, 0x91, 0x91, 0x6E, 0x00}, // B
{ 0x7E, 0x81, 0x81, 0x81, 0x42, 0x00}, // C
{ 0xFF, 0x81, 0x81, 0x42, 0x3C, 0x00}, // D
{ 0xFF, 0x91, 0x91, 0x91, 0x81, 0x00}, // E
{ 0xFF, 0x90, 0x90, 0x90, 0x80, 0x00}, // F
{ 0x7E, 0x81, 0x89, 0x89, 0x4E, 0x00}, // G
{ 0xFF, 0x10, 0x10, 0x10, 0xFF, 0x00}, // H
{ 0x81, 0x81, 0xFF, 0x81, 0x81, 0x00}, // I
{ 0x06, 0x01, 0x01, 0x01, 0xFE, 0x00}, // J
{ 0xFF, 0x18, 0x24, 0x42, 0x81, 0x00}, // K
{ 0xFF, 0x01, 0x01, 0x01, 0x01, 0x00}, // L
{ 0xFF, 0x40, 0x30, 0x40, 0xFF, 0x00}, // M
{ 0xFF, 0x40, 0x30, 0x08, 0xFF, 0x00}, // N
{ 0x7E, 0x81, 0x81, 0x81, 0x7E, 0x00}, // O
{ 0xFF, 0x88, 0x88, 0x88, 0x70, 0x00}, // P
{ 0x7E, 0x81, 0x85, 0x82, 0x7D, 0x00}, // Q
{ 0xFF, 0x88, 0x8C, 0x8A, 0x71, 0x00}, // R
{ 0x61, 0x91, 0x91, 0x91, 0x8E, 0x00}, // S
{ 0x80, 0x80, 0xFF, 0x80, 0x80, 0x00}, // T
{ 0xFE, 0x01, 0x01, 0x01, 0xFE, 0x00}, // U
{ 0xF0, 0x0C, 0x03, 0x0C, 0xF0, 0x00}, // V
{ 0xFF, 0x02, 0x0C, 0x02, 0xFF, 0x00}, // W
{ 0xC3, 0x24, 0x18, 0x24, 0xC3, 0x00}, // X
{ 0xE0, 0x10, 0x0F, 0x10, 0xE0, 0x00}, // Y
{ 0x83, 0x85, 0x99, 0xA1, 0xC1, 0x00}, // Z
{ 0x06, 0x29, 0x29, 0x29, 0x1F, 0x00}, // a
{ 0xFF, 0x09, 0x11, 0x11, 0x0E, 0x00}, // b
{ 0x1E, 0x21, 0x21, 0x21, 0x12, 0x00}, // c
{ 0x0E, 0x11, 0x11, 0x09, 0xFF, 0x00}, // d
{ 0x0E, 0x15, 0x15, 0x15, 0x0C, 0x00}, // e
{ 0x08, 0x7F, 0x88, 0x80, 0x40, 0x00}, // f
{ 0x30, 0x49, 0x49, 0x49, 0x7E, 0x00}, // g
{ 0xFF, 0x08, 0x10, 0x10, 0x0F, 0x00}, // h
{ 0x00, 0x00, 0x5F, 0x00, 0x00, 0x00}, // i
{ 0x02, 0x01, 0x21, 0xBE, 0x00, 0x00}, // j
{ 0xFF, 0x04, 0x0A, 0x11, 0x00, 0x00}, // k
{ 0x00, 0x81, 0xFF, 0x01, 0x00, 0x00}, // l
{ 0x3F, 0x20, 0x18, 0x20, 0x1F, 0x00}, // m
{ 0x3F, 0x10, 0x20, 0x20, 0x1F, 0x00}, // n
{ 0x0E, 0x11, 0x11, 0x11, 0x0E, 0x00}, // o
{ 0x3F, 0x24, 0x24, 0x24, 0x18, 0x00}, // p
{ 0x10, 0x28, 0x28, 0x18, 0x3F, 0x00}, // q
{ 0x1F, 0x08, 0x10, 0x10, 0x08, 0x00}, // r
{ 0x09, 0x15, 0x15, 0x15, 0x02, 0x00}, // s
{ 0x20, 0xFE, 0x21, 0x01, 0x02, 0x00}, // t
{ 0x1E, 0x01, 0x01, 0x02, 0x1F, 0x00}, // u
{ 0x1C, 0x02, 0x01, 0x02, 0x1C, 0x00}, // v
{ 0x1E, 0x01, 0x0E, 0x01, 0x1E, 0x00}, // w
{ 0x11, 0x0A, 0x04, 0x0A, 0x11, 0x00}, // x
{ 0x00, 0x39, 0x05, 0x05, 0x3E, 0x00}, // y
{ 0x11, 0x13, 0x15, 0x19, 0x11, 0x00}, // z
{ 0x00, 0x41, 0xFF, 0x01, 0x00, 0x00}, // 1
{ 0x43, 0x85, 0x89, 0x91, 0x61, 0x00}, // 2
{ 0x42, 0x81, 0x91, 0x91, 0x6E, 0x00}, // 3
{ 0x18, 0x28, 0x48, 0xFF, 0x08, 0x00}, // 4
{ 0xF2, 0x91, 0x91, 0x91, 0x8E, 0x00}, // 5
{ 0x1E, 0x29, 0x49, 0x89, 0x86, 0x00}, // 6
{ 0x80, 0x8F, 0x90, 0xA0, 0xC0, 0x00}, // 7
{ 0x6E, 0x91, 0x91, 0x91, 0x6E, 0x00}, // 8
{ 0x70, 0x89, 0x89, 0x8A, 0x7C, 0x00}, // 9
{ 0x7E, 0x89, 0x91, 0xA1, 0x7E, 0x00}, // 0
{ 0x60, 0x80, 0x8D, 0x90, 0x60, 0x00}, // ?
{ 0x00, 0x00, 0xFD, 0x00, 0x00, 0x00}, // !
{ 0x0F, 0x54, 0xB4, 0x54, 0x0F, 0x00}, // Ã…
};

static uint8_t semcon_logo[900][3] = {{250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {244, 69, 59}, {229, 53, 54}, {234, 161, 156}, {236, 172, 168}, {229, 53, 54}, {246, 68, 56}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {247, 67, 58}, {252, 255, 255}, {255, 255, 255}, {255, 255, 255}, {255, 255, 255}, {255, 255, 255}, {255, 255, 255}, {255, 255, 255}, {255, 255, 255}, {255, 255, 255}, {254, 255, 252}, {247, 66, 64}, {250, 66, 59}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {229, 118, 123}, {253, 254, 255}, {255, 255, 255}, {255, 255, 255}, {255, 255, 255}, {255, 255, 255}, {255, 255, 255}, {255, 255, 255}, {255, 255, 255}, {255, 255, 255}, {255, 255, 255}, {255, 255, 255}, {249, 255, 255}, {233, 153, 151}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {253, 252, 255}, {255, 255, 255}, {255, 255, 255}, {255, 255, 255}, {255, 255, 255}, {255, 255, 255}, {255, 255, 255}, {255, 255, 255}, {255, 255, 255}, {255, 255, 255}, {255, 255, 255}, {255, 255, 255}, {255, 255, 255}, {255, 255, 255}, {255, 255, 255}, {252, 255, 255}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {254, 239, 235}, {255, 255, 255}, {255, 255, 255}, {255, 255, 255}, {255, 255, 255}, {255, 255, 255}, {255, 255, 255}, {255, 255, 255}, {247, 222, 214}, 
{252, 219, 216}, {255, 255, 255}, {255, 255, 255}, {255, 255, 255}, {255, 255, 255}, {255, 255, 255}, {255, 255, 255}, {255, 255, 255}, {253, 252, 255}, {251, 65, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {249, 55, 46}, {255, 255, 255}, {255, 255, 255}, {255, 255, 255}, {255, 255, 255}, {255, 255, 255}, {236, 172, 168}, {246, 68, 56}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {249, 67, 53}, {229, 118, 123}, {255, 255, 255}, {255, 255, 255}, {255, 255, 255}, {255, 255, 255}, {255, 255, 255}, {238, 54, 42}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {255, 255, 255}, {255, 255, 255}, {255, 255, 255}, {255, 255, 255}, {255, 255, 255}, {237, 119, 117}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {231, 111, 101}, {255, 255, 255}, {255, 255, 255}, {255, 255, 255}, {255, 255, 255}, {255, 255, 255}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {246, 68, 56}, {255, 255, 255}, {255, 255, 255}, {255, 255, 255}, {255, 255, 255}, {255, 255, 249}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {255, 255, 253}, {255, 255, 255}, {255, 255, 255}, {255, 255, 255}, {255, 255, 255}, {244, 69, 59}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {240, 133, 132}, {255, 255, 255}, {255, 255, 255}, {255, 255, 255}, {255, 255, 255}, {251, 65, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {247, 67, 61}, {255, 255, 255}, {255, 255, 255}, {255, 255, 255}, {255, 255, 255}, {229, 137, 133}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {249, 255, 255}, {255, 255, 255}, {255, 255, 255}, {255, 255, 255}, {252, 255, 255}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {255, 255, 255}, {255, 255, 255}, {255, 255, 255}, {255, 255, 255}, {252, 255, 255}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {252, 255, 255}, {255, 255, 255}, {255, 255, 255}, {255, 255, 255}, {252, 255, 255}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {255, 255, 255}, {255, 255, 255}, {255, 255, 255}, {255, 255, 255}, {252, 255, 255}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {252, 255, 255}, {255, 255, 255}, {255, 255, 255}, {255, 255, 255}, {252, 255, 255}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {255, 255, 253}, {255, 255, 255}, {255, 255, 255}, {255, 255, 255}, {252, 255, 255}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {252, 255, 255}, {255, 255, 255}, {255, 255, 255}, {255, 255, 255}, {255, 255, 253}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {255, 255, 253}, {255, 255, 255}, {255, 255, 255}, {255, 255, 255}, 
{252, 255, 255}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {237, 119, 117}, {255, 255, 255}, {255, 255, 255}, {255, 255, 255}, {255, 255, 255}, {247, 66, 64}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {247, 66, 64}, {255, 255, 255}, {255, 255, 255}, {255, 255, 255}, {255, 255, 255}, {229, 118, 123}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {246, 68, 56}, {255, 255, 255}, {255, 255, 255}, {255, 255, 255}, {255, 255, 255}, {255, 255, 253}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {255, 255, 255}, {255, 255, 255}, {255, 255, 255}, {255, 255, 255}, {255, 255, 255}, {246, 68, 56}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {255, 255, 255}, {255, 255, 255}, {255, 255, 255}, {253, 252, 255}, {233, 51, 46}, {251, 65, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {251, 65, 58}, {233, 51, 46}, {253, 252, 255}, {255, 255, 255}, {255, 255, 255}, {255, 255, 255}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {248, 53, 51}, {254, 254, 255}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {253, 252, 255}, {249, 55, 46}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {247, 67, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {251, 65, 58}, {243, 191, 182}, {253, 254, 255}, {255, 255, 255}, {255, 255, 255}, {255, 255, 255}, {255, 255, 255}, {255, 255, 255}, {255, 255, 255}, {255, 255, 255}, {255, 255, 255}, {253, 254, 255}, {243, 191, 182}, {253, 63, 62}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {229, 118, 123}, {254, 254, 255}, {255, 255, 255}, {255, 255, 255}, {255, 255, 255}, {255, 255, 255}, {255, 255, 255}, {255, 255, 255}, {255, 255, 255}, {255, 255, 255}, {255, 255, 255}, {255, 255, 255}, {252, 255, 255}, {228, 139, 140}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {247, 67, 58}, {252, 255, 255}, {255, 255, 255}, {255, 255, 255}, {255, 255, 255}, {255, 255, 255}, {255, 255, 255}, {255, 255, 255}, {255, 255, 255}, {255, 255, 255}, {254, 255, 252}, {247, 66, 64}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, 
{250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {240, 71, 60}, {229, 53, 54}, {234, 161, 156}, {236, 172, 168}, {229, 53, 54}, {246, 68, 56}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}, {250, 66, 58}};


const uint8_t santa_right_img[16][16][3] = {
    { {0, 0, 0}, {0, 0, 0}, {0, 0, 0}, {0, 0, 0}, {0, 0, 0}, {0, 0, 0}, {0, 0, 0}, {0, 0, 0}, {255, 0, 64}, {255, 0, 64}, {255, 0, 64}, {255, 0, 64}, {0, 0, 0}, {0, 0, 0}, {0, 0, 0}, {0, 0, 0} },
    { {0, 0, 0}, {0, 0, 0}, {0, 0, 0}, {0, 0, 0}, {0, 0, 0}, {0, 0, 0}, {0, 0, 0}, {255, 0, 64}, {255, 0, 64}, {255, 0, 64}, {0, 0, 0}, {255, 0, 64}, {255, 0, 64}, {0, 0, 0}, {0, 0, 0}, {0, 0, 0} },
    { {0, 0, 0}, {0, 0, 0}, {0, 0, 0}, {0, 0, 0}, {0, 0, 0}, {0, 0, 0}, {255, 0, 64}, {255, 0, 64}, {255, 0, 64}, {255, 0, 64}, {0, 0, 0}, {0, 0, 0}, {255, 0, 64}, {255, 0, 64}, {0, 0, 0}, {0, 0, 0} },
    { {0, 0, 0}, {0, 0, 0}, {0, 0, 0}, {0, 0, 0}, {0, 0, 0}, {255, 0, 64}, {255, 0, 64}, {255, 0, 64}, {255, 0, 64}, {255, 0, 64}, {255, 0, 64}, {0, 0, 0}, {0, 0, 0}, {0, 0, 0}, {0, 0, 0}, {0, 0, 0} },
    { {0, 0, 0}, {0, 0, 0}, {0, 0, 0}, {0, 0, 0}, {255, 0, 64}, {255, 0, 64}, {255, 0, 64}, {255, 0, 64}, {255, 0, 64}, {255, 0, 64}, {255, 0, 64}, {255, 0, 64}, {0, 0, 0}, {0, 0, 0}, {0, 0, 0}, {0, 0, 0} },
    { {0, 0, 0}, {0, 0, 0}, {0, 0, 0}, {255, 0, 64}, {255, 0, 64}, {255, 0, 64}, {255, 0, 64}, {255, 0, 64}, {255, 0, 64}, {255, 0, 64}, {255, 0, 64}, {255, 0, 64}, {255, 0, 64}, {0, 0, 0}, {0, 0, 0}, {0, 0, 0} },
    { {0, 0, 0}, {0, 0, 0}, {255, 0, 64}, {255, 0, 64}, {255, 0, 64}, {255, 0, 64}, {255, 0, 64}, {255, 0, 64}, {255, 0, 64}, {255, 0, 64}, {255, 0, 64}, {255, 0, 64}, {255, 0, 64}, {255, 0, 64}, {0, 0, 0}, {0, 0, 0} },
    { {0, 0, 0}, {0, 0, 0}, {255, 255, 255}, {132, 71, 55}, {132, 71, 55}, {132, 71, 55}, {132, 71, 55}, {132, 71, 55}, {132, 71, 55}, {132, 71, 55}, {132, 71, 55}, {132, 71, 55}, {132, 71, 55}, {255, 255, 255}, {0, 0, 0}, {0, 0, 0} },
    { {0, 0, 0}, {0, 0, 0}, {255, 255, 255}, {255, 255, 255}, {132, 71, 55}, {255, 255, 255}, {132, 71, 55}, {132, 71, 55}, {132, 71, 55}, {255, 255, 255}, {132, 71, 55}, {132, 71, 55}, {255, 255, 255}, {255, 255, 255}, {0, 0, 0}, {0, 0, 0} },
    { {0, 0, 0}, {0, 0, 0}, {0, 0, 0}, {255, 255, 255}, {132, 71, 55}, {132, 71, 55}, {132, 71, 55}, {132, 71, 55}, {132, 71, 55}, {132, 71, 55}, {132, 71, 55}, {132, 71, 55}, {255, 255, 255}, {0, 0, 0}, {0, 0, 0}, {0, 0, 0} },
    { {0, 0, 0}, {0, 0, 0}, {0, 0, 0}, {255, 255, 255}, {255, 255, 255}, {132, 71, 55}, {132, 71, 55}, {132, 71, 55}, {132, 71, 55}, {132, 71, 55}, {132, 71, 55}, {255, 255, 255}, {255, 255, 255}, {0, 0, 0}, {0, 0, 0}, {0, 0, 0} },
    { {0, 0, 0}, {255, 0, 64}, {255, 0, 64}, {255, 255, 255}, {255, 255, 255}, {255, 255, 255}, {132, 71, 55}, {132, 71, 55}, {132, 71, 55}, {132, 71, 55}, {255, 255, 255}, {255, 255, 255}, {255, 255, 255}, {255, 0, 64}, {255, 0, 64}, {0, 0, 0} },
    { {255, 0, 64}, {255, 0, 64}, {255, 0, 64}, {255, 0, 64}, {255, 255, 255}, {255, 255, 255}, {255, 255, 255}, {255, 255, 255}, {255, 255, 255}, {255, 255, 255}, {255, 255, 255}, {255, 255, 255}, {255, 0, 64}, {255, 0, 64}, {255, 0, 64}, {255, 0, 64} },
    { {255, 0, 64}, {255, 0, 64}, {255, 0, 64}, {255, 0, 64}, {255, 0, 64}, {255, 255, 255}, {255, 255, 255}, {255, 255, 255}, {255, 255, 255}, {255, 255, 255}, {255, 255, 255}, {255, 0, 64}, {255, 0, 64}, {255, 0, 64}, {255, 0, 64}, {255, 0, 64} },
    { {255, 0, 64}, {255, 0, 64}, {255, 0, 64}, {255, 0, 64}, {255, 0, 64}, {255, 255, 255}, {255, 255, 255}, {255, 255, 255}, {255, 255, 255}, {255, 255, 255}, {255, 255, 255}, {255, 0, 64}, {255, 0, 64}, {255, 0, 64}, {255, 0, 64}, {255, 0, 64} },
    { {255, 0, 64}, {255, 0, 64}, {255, 0, 64}, {255, 0, 64}, {255, 0, 64}, {255, 0, 64}, {255, 255, 255}, {255, 255, 255}, {255, 255, 255}, {255, 0, 64}, {255, 0, 64}, {255, 0, 64}, {255, 0, 64}, {255, 0, 64}, {255, 0, 64}, {255, 0, 64} },
};

const uint8_t santa_left_img[16][16][3] = {
    { {0, 0, 0}, {0, 0, 0}, {0, 0, 0}, {0, 0, 0}, {0, 0, 0}, {0, 0, 0}, {0, 0, 0}, {0, 0, 0}, {255, 0, 64}, {255, 0, 64}, {255, 0, 64}, {255, 0, 64}, {0, 0, 0}, {0, 0, 0}, {0, 0, 0}, {0, 0, 0} },
    { {0, 0, 0}, {0, 0, 0}, {0, 0, 0}, {0, 0, 0}, {0, 0, 0}, {0, 0, 0}, {0, 0, 0}, {255, 0, 64}, {255, 0, 64}, {255, 0, 64}, {0, 0, 0}, {255, 0, 64}, {255, 0, 64}, {0, 0, 0}, {0, 0, 0}, {0, 0, 0} },
    { {0, 0, 0}, {0, 0, 0}, {0, 0, 0}, {0, 0, 0}, {0, 0, 0}, {0, 0, 0}, {255, 0, 64}, {255, 0, 64}, {255, 0, 64}, {255, 0, 64}, {0, 0, 0}, {0, 0, 0}, {255, 0, 64}, {255, 0, 64}, {0, 0, 0}, {0, 0, 0} },
    { {0, 0, 0}, {0, 0, 0}, {0, 0, 0}, {0, 0, 0}, {0, 0, 0}, {255, 0, 64}, {255, 0, 64}, {255, 0, 64}, {255, 0, 64}, {255, 0, 64}, {255, 0, 64}, {0, 0, 0}, {0, 0, 0}, {0, 0, 0}, {0, 0, 0}, {0, 0, 0} },
    { {0, 0, 0}, {0, 0, 0}, {0, 0, 0}, {0, 0, 0}, {255, 0, 64}, {255, 0, 64}, {255, 0, 64}, {255, 0, 64}, {255, 0, 64}, {255, 0, 64}, {255, 0, 64}, {255, 0, 64}, {0, 0, 0}, {0, 0, 0}, {0, 0, 0}, {0, 0, 0} },
    { {0, 0, 0}, {0, 0, 0}, {0, 0, 0}, {255, 0, 64}, {255, 0, 64}, {255, 0, 64}, {255, 0, 64}, {255, 0, 64}, {255, 0, 64}, {255, 0, 64}, {255, 0, 64}, {255, 0, 64}, {255, 0, 64}, {0, 0, 0}, {0, 0, 0}, {0, 0, 0} },
    { {0, 0, 0}, {0, 0, 0}, {255, 0, 64}, {255, 0, 64}, {255, 0, 64}, {255, 0, 64}, {255, 0, 64}, {255, 0, 64}, {255, 0, 64}, {255, 0, 64}, {255, 0, 64}, {255, 0, 64}, {255, 0, 64}, {255, 0, 64}, {0, 0, 0}, {0, 0, 0} },
    { {0, 0, 0}, {0, 0, 0}, {255, 255, 255}, {132, 71, 55}, {132, 71, 55}, {132, 71, 55}, {132, 71, 55}, {132, 71, 55}, {132, 71, 55}, {132, 71, 55}, {132, 71, 55}, {132, 71, 55}, {132, 71, 55}, {255, 255, 255}, {0, 0, 0}, {0, 0, 0} },
    { {0, 0, 0}, {0, 0, 0}, {255, 255, 255}, {255, 255, 255}, {132, 71, 55}, {132, 71, 55}, {255, 255, 255}, {132, 71, 55}, {132, 71, 55}, {132, 71, 55}, {255, 255, 255}, {132, 71, 55}, {255, 255, 255}, {255, 255, 255}, {0, 0, 0}, {0, 0, 0} },
    { {0, 0, 0}, {0, 0, 0}, {0, 0, 0}, {255, 255, 255}, {132, 71, 55}, {132, 71, 55}, {132, 71, 55}, {132, 71, 55}, {132, 71, 55}, {132, 71, 55}, {132, 71, 55}, {132, 71, 55}, {255, 255, 255}, {0, 0, 0}, {0, 0, 0}, {0, 0, 0} },
    { {0, 0, 0}, {0, 0, 0}, {0, 0, 0}, {255, 255, 255}, {255, 255, 255}, {132, 71, 55}, {132, 71, 55}, {132, 71, 55}, {132, 71, 55}, {132, 71, 55}, {132, 71, 55}, {255, 255, 255}, {255, 255, 255}, {0, 0, 0}, {0, 0, 0}, {0, 0, 0} },
    { {0, 0, 0}, {255, 0, 64}, {255, 0, 64}, {255, 255, 255}, {255, 255, 255}, {255, 255, 255}, {132, 71, 55}, {132, 71, 55}, {132, 71, 55}, {132, 71, 55}, {255, 255, 255}, {255, 255, 255}, {255, 255, 255}, {255, 0, 64}, {255, 0, 64}, {0, 0, 0} },
    { {255, 0, 64}, {255, 0, 64}, {255, 0, 64}, {255, 0, 64}, {255, 255, 255}, {255, 255, 255}, {255, 255, 255}, {255, 255, 255}, {255, 255, 255}, {255, 255, 255}, {255, 255, 255}, {255, 255, 255}, {255, 0, 64}, {255, 0, 64}, {255, 0, 64}, {255, 0, 64} },
    { {255, 0, 64}, {255, 0, 64}, {255, 0, 64}, {255, 0, 64}, {255, 0, 64}, {255, 255, 255}, {255, 255, 255}, {255, 255, 255}, {255, 255, 255}, {255, 255, 255}, {255, 255, 255}, {255, 0, 64}, {255, 0, 64}, {255, 0, 64}, {255, 0, 64}, {255, 0, 64} },
    { {255, 0, 64}, {255, 0, 64}, {255, 0, 64}, {255, 0, 64}, {255, 0, 64}, {255, 255, 255}, {255, 255, 255}, {255, 255, 255}, {255, 255, 255}, {255, 255, 255}, {255, 255, 255}, {255, 0, 64}, {255, 0, 64}, {255, 0, 64}, {255, 0, 64}, {255, 0, 64} },
    { {255, 0, 64}, {255, 0, 64}, {255, 0, 64}, {255, 0, 64}, {255, 0, 64}, {255, 0, 64}, {255, 255, 255}, {255, 255, 255}, {255, 255, 255}, {255, 0, 64}, {255, 0, 64}, {255, 0, 64}, {255, 0, 64}, {255, 0, 64}, {255, 0, 64}, {255, 0, 64} },
};

const uint8_t polka_img[16][16][3] = {
    { {90, 197, 79}, {90, 197, 79}, {90, 197, 79}, {90, 197, 79}, {90, 197, 79}, {90, 197, 79}, {90, 197, 79}, {90, 197, 79}, {90, 197, 79}, {90, 197, 79}, {90, 197, 79}, {90, 197, 79}, {90, 197, 79}, {90, 197, 79}, {90, 197, 79}, {90, 197, 79} },
    { {90, 197, 79}, {90, 197, 79}, {90, 197, 79}, {90, 197, 79}, {90, 197, 79}, {90, 197, 79}, {90, 197, 79}, {90, 197, 79}, {90, 197, 79}, {90, 197, 79}, {90, 197, 79}, {90, 197, 79}, {90, 197, 79}, {255, 255, 255}, {90, 197, 79}, {90, 197, 79} },
    { {90, 197, 79}, {90, 197, 79}, {90, 197, 79}, {90, 197, 79}, {90, 197, 79}, {90, 197, 79}, {255, 0, 64}, {255, 0, 64}, {90, 197, 79}, {90, 197, 79}, {90, 197, 79}, {90, 197, 79}, {255, 0, 64}, {90, 197, 79}, {255, 0, 64}, {90, 197, 79} },
    { {90, 197, 79}, {90, 197, 79}, {90, 197, 79}, {90, 197, 79}, {90, 197, 79}, {255, 0, 64}, {255, 0, 64}, {255, 255, 255}, {255, 255, 255}, {90, 197, 79}, {90, 197, 79}, {90, 197, 79}, {90, 197, 79}, {90, 197, 79}, {255, 255, 255}, {90, 197, 79} },
    { {90, 197, 79}, {90, 197, 79}, {90, 197, 79}, {90, 197, 79}, {255, 255, 255}, {255, 255, 255}, {90, 197, 79}, {90, 197, 79}, {255, 255, 255}, {255, 0, 64}, {90, 197, 79}, {90, 197, 79}, {90, 197, 79}, {90, 197, 79}, {255, 0, 64}, {90, 197, 79} },
    { {90, 197, 79}, {90, 197, 79}, {90, 197, 79}, {90, 197, 79}, {255, 255, 255}, {90, 197, 79}, {90, 197, 79}, {90, 197, 79}, {255, 0, 64}, {255, 0, 64}, {90, 197, 79}, {90, 197, 79}, {90, 197, 79}, {90, 197, 79}, {255, 255, 255}, {90, 197, 79} },
    { {90, 197, 79}, {90, 197, 79}, {90, 197, 79}, {90, 197, 79}, {90, 197, 79}, {90, 197, 79}, {90, 197, 79}, {90, 197, 79}, {255, 0, 64}, {255, 255, 255}, {90, 197, 79}, {90, 197, 79}, {90, 197, 79}, {90, 197, 79}, {255, 0, 64}, {90, 197, 79} },
    { {90, 197, 79}, {90, 197, 79}, {90, 197, 79}, {90, 197, 79}, {90, 197, 79}, {90, 197, 79}, {90, 197, 79}, {90, 197, 79}, {255, 255, 255}, {255, 255, 255}, {90, 197, 79}, {90, 197, 79}, {90, 197, 79}, {90, 197, 79}, {90, 197, 79}, {90, 197, 79} },
    { {90, 197, 79}, {90, 197, 79}, {90, 197, 79}, {90, 197, 79}, {90, 197, 79}, {90, 197, 79}, {90, 197, 79}, {90, 197, 79}, {255, 255, 255}, {255, 0, 64}, {90, 197, 79}, {90, 197, 79}, {90, 197, 79}, {90, 197, 79}, {90, 197, 79}, {90, 197, 79} },
    { {90, 197, 79}, {90, 197, 79}, {90, 197, 79}, {255, 255, 255}, {90, 197, 79}, {90, 197, 79}, {90, 197, 79}, {90, 197, 79}, {255, 0, 64}, {255, 0, 64}, {90, 197, 79}, {90, 197, 79}, {90, 197, 79}, {90, 197, 79}, {90, 197, 79}, {90, 197, 79} },
    { {90, 197, 79}, {90, 197, 79}, {255, 0, 64}, {90, 197, 79}, {255, 0, 64}, {90, 197, 79}, {90, 197, 79}, {90, 197, 79}, {255, 0, 64}, {255, 255, 255}, {90, 197, 79}, {90, 197, 79}, {90, 197, 79}, {90, 197, 79}, {90, 197, 79}, {90, 197, 79} },
    { {90, 197, 79}, {90, 197, 79}, {90, 197, 79}, {90, 197, 79}, {255, 255, 255}, {90, 197, 79}, {90, 197, 79}, {90, 197, 79}, {255, 255, 255}, {255, 255, 255}, {90, 197, 79}, {90, 197, 79}, {90, 197, 79}, {90, 197, 79}, {90, 197, 79}, {90, 197, 79} },
    { {90, 197, 79}, {90, 197, 79}, {90, 197, 79}, {90, 197, 79}, {255, 0, 64}, {90, 197, 79}, {90, 197, 79}, {90, 197, 79}, {255, 255, 255}, {255, 0, 64}, {90, 197, 79}, {90, 197, 79}, {90, 197, 79}, {90, 197, 79}, {90, 197, 79}, {90, 197, 79} },
    { {90, 197, 79}, {90, 197, 79}, {90, 197, 79}, {90, 197, 79}, {255, 255, 255}, {90, 197, 79}, {90, 197, 79}, {90, 197, 79}, {255, 0, 64}, {255, 0, 64}, {90, 197, 79}, {90, 197, 79}, {90, 197, 79}, {90, 197, 79}, {90, 197, 79}, {90, 197, 79} },
    { {90, 197, 79}, {90, 197, 79}, {90, 197, 79}, {90, 197, 79}, {255, 0, 64}, {90, 197, 79}, {90, 197, 79}, {90, 197, 79}, {90, 197, 79}, {90, 197, 79}, {90, 197, 79}, {90, 197, 79}, {90, 197, 79}, {90, 197, 79}, {90, 197, 79}, {90, 197, 79} },
    { {90, 197, 79}, {90, 197, 79}, {90, 197, 79}, {90, 197, 79}, {90, 197, 79}, {90, 197, 79}, {90, 197, 79}, {90, 197, 79}, {90, 197, 79}, {90, 197, 79}, {90, 197, 79}, {90, 197, 79}, {90, 197, 79}, {90, 197, 79}, {90, 197, 79}, {90, 197, 79} },
};

const char letterPositions[] = " ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz1234567890?!Ã…";

size_t selected_color = 1;
size_t selected_repetitions = 1;


uint8_t get_letter_pos( char letter ) {
    for (uint8_t i = 0; i < sizeof(letterPositions); i++ )
    {
        if ( letter == letterPositions[i] ) {
            return i;
        }
    }
    return 0;
}

static void set_pixel_10_30( uint16_t row, uint16_t column, size_t color )  {
    uint16_t led_no = row*COLUMNS;

    if(row %2) {
        led_no += (COLUMNS - 1) - column;
    }
        else {
  	    led_no += column;
    }

    memcpy(&pixels[led_no], &colors[color], sizeof(struct led_rgb));
}

static void set_pixel_16_16( uint16_t row, uint16_t column, size_t color )  {
    uint16_t led_no = row*COLUMNS;

    if((row+1) %2) {
        led_no += (COLUMNS - 1) - column;
    }
        else {
  	    led_no += column;
    }

    memcpy(&pixels[led_no + display_offset], &colors[color], sizeof(struct led_rgb));
}

static void write_char( const uint8_t* c, int x_offset) {
	int x_pos = 0;
  	for( uint8_t x=0; x<6; x++ ) {
  		x_pos = x + x_offset;
    	if( x_pos >=0 && x_pos < COLUMNS ) {
    		for( uint8_t y=0; y<8; y++ ) {
   	  			if(( 0x80 >> y ) & c[x] ) {
	  				set_pixel_16_16( y+1, x_pos, selected_color );
      			}
  			}
    	}
  	}
}

static void update_led_strip( void ) {
    int rc;

    rc = led_strip_update_rgb(strip, pixels, STRIP_NUM_PIXELS);
    if (rc) {
        LOG_ERR("couldn't update strip: %d", rc);
    }
}

static void fill_pixel_memory( size_t color ) {
    /* Fill pixel memory */
    for (uint16_t led_no = 0; led_no < STRIP_NUM_PIXELS; led_no++) {
        memcpy(&pixels[led_no], &colors[color], sizeof(struct led_rgb));
    }
}

static void clear_pixel_memory( void ) {
    /* Clear pixel memory */
    memset(pixels, 0x00, sizeof(pixels));
}

static void clear_pixel_memory_page( void ) {
    /* Clear pixel memory */
    memset(&pixels[display_offset], 0x00, 256);
}

void neopixel_set_repetitions( size_t repetitions ) {
    selected_repetitions = repetitions;
}

void neopixel_toggle_all_pixels( void ) {
    for (uint16_t y = 0; y < ROWS; y++ ) {
        for (uint16_t x = 0; x < COLUMNS; x++ ) {
            clear_pixel_memory();
            set_pixel_16_16(y, x, selected_color);
            update_led_strip();
        }
    }
}


void neopixel_display_write_string( char* text, size_t length ) {
    uint8_t chPos = 0;
  	int startPos = COLUMNS - 1;
  	int numPixels = 6 * length;
    int j = 0;

    while (j < selected_repetitions ) {
        startPos = COLUMNS - 1;
        while ((startPos + numPixels) >= 0) {
            clear_pixel_memory();
            for (int j=0; j<length; j++) {
                chPos = get_letter_pos( text[j] );

                write_char((const uint8_t*)letters[chPos],startPos + j*6);
            }
            startPos -= 1;
            update_led_strip();                          //  Update strip to match
            k_sleep(DELAY_TIME);
        }
        j++;
    }
}


void neopixel_write_semcon_logo( void ) {

    struct led_rgb color;
    int x, y, led_no, table_idx;
    
    int row_start = 0;
    int j = 0;

    while (j < selected_repetitions ) {
        for (row_start = 0; row_start < 20; row_start++ )
        {
            clear_pixel_memory();   
            for(y = 0; y < ROWS; y++ ) {
                for(x = 0; x < COLUMNS; x++ ) {
                    led_no = y*COLUMNS;
                    if(y%2) {
                        led_no += (COLUMNS - 1) - x;
                    }
                    else {
                        led_no += x;
                    }
                    table_idx = (row_start + y)*COLUMNS + x;
                    color.r = semcon_logo[table_idx][0]/4;
                    color.g = semcon_logo[table_idx][1]/4;
                    color.b = semcon_logo[table_idx][2]/4;

                    //color = RGB(test_logo[y*COLUMNS + x][0], test_logo[y*COLUMNS + x][1],test_logo[y*COLUMNS + x][2]);
                    memcpy(&pixels[led_no], &color, sizeof(struct led_rgb));
                }
            }
            update_led_strip();
            k_sleep(DELAY_TIME_LOGO);
        }
        for (row_start = 19; row_start >= 0; row_start-= 1 )
        {
            clear_pixel_memory();   
            for(y = 0; y < ROWS; y++ ) {
                for(x = 0; x < COLUMNS; x++ ) {
                    led_no = y*COLUMNS;
                    if(y%2) {
                        led_no += (COLUMNS - 1) - x;
                    }
                    else {
                        led_no += x;
                    }
                    table_idx = (row_start + y)*COLUMNS + x;
                    color.r = semcon_logo[table_idx][0]/8;
                    color.g = semcon_logo[table_idx][1]/8;
                    color.b = semcon_logo[table_idx][2]/8;

                    memcpy(&pixels[led_no], &color, sizeof(struct led_rgb));
                }
            }
            update_led_strip();
            k_sleep(DELAY_TIME_LOGO);
        }
        j++;
    }
    clear_pixel_memory();   
    update_led_strip();
}

static void fill_all_addresses(void) {
    for (uint16_t i = 0; i < STRIP_NUM_PIXELS; i++ ) {
        memcpy(&pixels[i], &colors[selected_color], sizeof(struct led_rgb));
        update_led_strip();
    }
}

void neopixel_display_16_16_image( const uint8_t pixel_array[16][16][3]) {
    uint8_t row = 0;
    uint8_t column = 0;
    uint16_t led_idx = 0;
    struct led_rgb color;

    clear_pixel_memory_page();   
    while(row < 16) {
        // Odd rows
        if(row % 2) {
            while(column < 16) {
                color.r = pixel_array[row][column][0]/8;
                color.g = pixel_array[row][column][1]/8;
                color.b = pixel_array[row][column][2]/8;
                memcpy(&pixels[led_idx + display_offset], &color, sizeof(struct led_rgb));
                led_idx++;
                column++;
            }
        } else { // Even rows
            while(column < 16) {
                color.r = pixel_array[row][15 - column][0]/8;
                color.g = pixel_array[row][15 - column][1]/8;
                color.b = pixel_array[row][15 - column][2]/8;
                memcpy(&pixels[led_idx + display_offset], &color, sizeof(struct led_rgb));
                led_idx++;
                column++;
            }   
        }
        row++;
        column = 0;
    }
    update_led_strip();
}

void neopixel_binary_byte_value(uint8_t byteValue) {
    clear_pixel_memory();
    for(int i = 0; i < 8; i++) {
        if((0x80>>i) & byteValue) {
            memcpy(&pixels[i], &colors[0], sizeof(struct led_rgb));
            memcpy(&pixels[i+8], &colors[1], sizeof(struct led_rgb));
            memcpy(&pixels[i+16], &colors[2], sizeof(struct led_rgb));
        }

    }
    update_led_strip();
}

uint8_t string_to_byte( char* str, uint32_t length ) {
    uint8_t ret_val = 0;

    if(length > 0) {
        ret_val = str[0] -'0';
    }
    if(length > 1) {
        ret_val = (ret_val * 10) + (str[1] - '0');
    }
    if(length > 2) {
        ret_val = (ret_val * 10) + (str[2] - '0');
    }
    return ret_val;
}

void neopixel_command( char* text, size_t length, size_t page ) {

    if(page == 0) {
        uint8_t byteVal = string_to_byte(text, length);
        neopixel_binary_byte_value(byteVal);
    }

}

